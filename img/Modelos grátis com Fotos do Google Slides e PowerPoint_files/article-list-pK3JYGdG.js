import{d as v}from"./download-BRTVkv0Q.js";import{f as m,m as g}from"./favorite-BxCgFJRk.js";const $=function(e,n,a,r,h,l,c,d){return{slug:n,isFavorite:e,activeColor:r,loadingStatus:"idle",variantChanged:!1,touching:Promise.resolve(),scrolling:Promise.resolve(),variantMedia:[],activeMedia:a.slice(1),totalSlides:0,currentSlide:0,downloadOpened:!1,isRelated:h,isPremium:l,isCommonUser:c,variantWepikEditables:d,init(){this.resetPosition()},resetPosition(){this.$refs.container.scrollLeft=0},previous(){const t=this._calculateActive();this._moveTo(t-1,this.$refs.container)},async next(){const t=this._calculateActive();this._moveTo(t+1,this.$refs.container),this.activeMedia.length<=1&&(await this._loadAllSlides(),this.$nextTick(()=>this._moveTo(t+1,this.$refs.container))),this.$nextTick(()=>{var s;return(s=this.$refs.container.querySelectorAll(".slide img")[t+2])==null?void 0:s.removeAttribute("loading")})},touch(){this.loadingStatus==="idle"&&(this.activeMedia.length<=1&&this._loadAllSlides(),this.touching=new Promise(t=>{this.$refs.container.addEventListener("touchend",t,{once:!0})}),this._loadAllSlides())},scrolls(){let t=this;this.scrolling=new Promise(s=>{let i=null;this.$refs.container.addEventListener("scroll",function o(){clearTimeout(i),i=setTimeout(()=>{s(),t.$refs.container.removeEventListener("scroll",o)},100)},{passive:!0})}),this.currentSlide=this._calculateActive(),this._loadAllSlides()},async changeVariant(t,s){if(this.activeColor=t,t in this.variantMedia&&this.variantMedia[t].length){this.activeMedia=this.variantMedia[t].map(i=>i.url),this.totalSlides=this.activeMedia.length;return}!this.variantChanged&&this.currentSlide===0&&(this.activeMedia=[this.$refs.first.currentSrc]),await(await fetch(`/api/articles/${n}/images?variant=${t}`)).json().then(i=>{this.variantMedia[t]=i.data}),this.variantMedia[t].length&&(this.activeMedia=this.variantMedia[t].map(i=>i.url),this.totalSlides=this.activeMedia.length),this.variantChanged=!0},async handleEvents(t,s,i,o,u,f){gtm.selectSlide(this._formatGTMLocation(f),i,o,t,s,u),l&&c&&await sendSalesforceEvent("APIEvent-5251283c-cfe2-647e-b406-95e829bef72f")},_calculateActive(){const t=this.$refs.container.getBoundingClientRect().width,s=this.$refs.container.scrollLeft;return Math.floor((s+t/2)/t)},_moveTo(t){const i=this.$refs.container.getBoundingClientRect().width*t;this.$refs.container.scrollTo(i,0),this._loadAllSlides()},async _loadAllSlides(){if(this.loadingStatus!=="idle")return;this.loadingStatus="loading";let t="";this.activeColor&&(t=`?variant=${this.activeColor}`);const s=await(await fetch(`/api/articles/${n}/images${t}`)).json();this.loadingStatus="done";const i=s.data;this.totalSlides=i.length,await Promise.race([Promise.all([this.scrolling,this.touching]),new Promise(o=>setTimeout(o,1e3))]),this.activeMedia=[...this.activeMedia,...i.slice(2).map(o=>o.url)]},_formatGTMLocation(t){switch(t){case"search":return"search_results_list";case"detail-related":return"related_resources";case"home-infographics":return"home";case"home-latest":return"home";case"home-popular":return"home";default:return"search_results_list"}}}},w=function(){return{loadingStatus:"idle",currentActive:0,lastIndex:null,init(){this.resetPosition(),this.lastIndex=this.lastPossibleIndex()},resetPosition(){this.$refs.container.scrollLeft=0},async next(){const e=this._calculateFirstActive();e!==this.lastIndex&&(this.currentActive=e+1,this._moveTo(this.currentActive,this.$refs.container))},previous(){const e=this._calculateFirstActive();e!==0&&(this.currentActive=e-1,this._moveTo(this.currentActive,this.$refs.container))},touch(){this.loadingStatus==="idle"&&(this.touching=new Promise(e=>{this.$refs.container.addEventListener("touchend",e,{once:!0})}))},scrolls(){let e=this;this.scrolling=new Promise(n=>{let a=null;this.$refs.container.addEventListener("scroll",function r(){clearTimeout(a),a=setTimeout(()=>{n(),e.$refs.container.removeEventListener("scroll",r)},100)},{passive:!0})}),this.currentSlide=this._calculateFirstActive()},_calculateFirstActive(){const e=this.$refs.collection.getBoundingClientRect().width,n=this.$refs.container.scrollLeft;return Math.floor((n+e/2)/e)},_moveTo(e){const a=this.$refs.collection.getBoundingClientRect().width*e;this.$refs.container.scrollTo(a,0)},lastPossibleIndex(){const e=this.$refs.collection.getBoundingClientRect().width,n=this.$refs.container.scrollWidth,a=Math.ceil(n/e),r=Math.floor(this.$refs.container.clientWidth/e);return Math.max(a-r,0)}}};document.addEventListener("alpine:init",()=>{Alpine.data("download",v),Alpine.data("box",$),Alpine.data("collection",w),Alpine.data("favorite",m),Alpine.data("modalNewFolder",g)});