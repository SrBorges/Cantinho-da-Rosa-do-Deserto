const c=function(l,n,h){const a=s=>{const i=/(\b)(on\S+)(\s*)=|javascript|<(|\/|[^\/>][^>]+|\/[^>][^>]+)>/ig,t=/[\/\.]{1,2}/g;return s.replace(i,"").replace(t,"")};return h=a(h),{filledSearch:h,lang:l,isMinimal:n,searchText:h,originalText:h,results:[],templates:[],selectedOption:!1,showResults:!1,hasBeenSearched:!1,searchingFromHistory:!1,unusedVar:!1,responses:{},focused(){this.showResults=!0,!this.hasBeenSearched&&this.searchText.length>1&&this.search(null,!1)},async search(s=null){if(s!==null&&[37,38,39,40].includes(s.keyCode))return!1;if(this.searchText=a(this.searchText),this.originalText=this.searchText,this.selectedOption=!1,this.results=[],this.templates=[],this.showResults=!0,this.results=this._searchWithHistory([]),this.searchText.length>1){this.hasBeenSearched=!0;const i=`/${this.lang}/autocomplete/${this.searchText}?includeBestItems=${this.isMinimal?0:1}`,t=`${this.lang}_${this.searchText}_${this.isMinimal?0:1}`;this.responses[t]||(this.responses[t]=await(await fetch(i)).json());const r=this.responses[t];this.results=this._searchWithHistory(r.results),this.templates=r.templates}},submitSearch(){this.$refs.form.submit()},resetOptionNavigation(){this.selectedOption=!1,this.searchText=this.originalText},hideSearch(){this.$refs.searchinput.blur(),this.showResults=!1,this.resetOptionNavigation()},resetSearch(){this.originalText="",this.results=[],this.templates=[],this.resetOptionNavigation(),this.$refs.searchinput.focus(),this.$nextTick(()=>{this.showResults=!0})},selectNext(){this._moveTo(this.selectedOption+1,0)&&(this.searchText=this.results[this.selectedOption].search,this.searchingFromHistory=this.results[this.selectedOption].fromHistory)},selectPrev(){const s=this.results.length-1;this._moveTo(this.selectedOption-1,s)&&(this.searchText=this.results[this.selectedOption].search,this.searchingFromHistory=this.results[this.selectedOption].fromHistory)},selectOption(s){this.searchingFromHistory=s.fromHistory,this.searchText=s.search,this.$nextTick(()=>{this.submitSearch()})},isInputFocused(){return this.$refs.searchinput===document.activeElement},_moveTo(s,i){return this.results.length?(this.selectedOption=this.selectedOption!==!1?s:i,this.results[this.selectedOption]||(this.selectedOption=i),!0):!1},_searchWithHistory(s){let t=JSON.parse(window.localStorage.searchHistory??"[]").filter(e=>e.startsWith(this.searchText.toLowerCase())).reverse(),r=t.concat(s.map(e=>e.search)).map(e=>a(e)),o=[...new Set(r)];return o=o.map(e=>({search:e,fromHistory:t.includes(e),highlightResult:e.replace(this.searchText,`<em>${this.searchText}</em>`)})),o.slice(0,8)}}};document.addEventListener("alpine:init",()=>{Alpine.data("searcher",c)});